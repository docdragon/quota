<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trình Tạo Báo Giá Chuyên Nghiệp</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="login-view">
        <div class="login-box">
            <h1 class="logo">Báo Giá Pro</h1>
            <p>Đăng nhập để quản lý và đồng bộ báo giá của bạn</p>
            <button id="login-btn">
                <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="google" class="svg-inline--fa fa-google fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><path fill="currentColor" d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 126 23.4 172.9 61.9l-69.2 69.2c-20.3-18.4-46.4-29.2-76.9-29.2-60.2 0-109 48.8-109 109s48.8 109 109 109c63.4 0 113.3-44.5 120-103.3H248v-85.3h236.1c2.3 12.7 3.9 26.1 3.9 40.2z"></path></svg>
                Đăng nhập với Google
            </button>
        </div>
    </div>

    <header class="main-header no-print" style="display: none;">
        <div class="header-content">
            <a href="#" class="logo">Báo Giá Pro</a>
            <nav class="main-nav">
                <button id="nav-editor" class="nav-btn active">Soạn Thảo</button>
                <button id="nav-list" class="nav-btn">Danh Sách</button>
                <button id="nav-management" class="nav-btn">Quản lý</button>
            </nav>
            <div id="user-profile" style="display: none;">
                 <span id="user-name"></span>
                 <img id="user-avatar" src="" alt="User Avatar">
                 <button id="logout-btn" title="Đăng xuất">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    <span>Đăng xuất</span>
                </button>
            </div>
        </div>
    </header>

    <main id="app-container" style="display: none;">
        <div id="editor-view">
            <div id="editor-title-bar" class="no-print">
                <label for="quote-name-input">Tên báo giá:</label>
                <input type="text" id="quote-name-input" placeholder="Ví dụ: Báo giá nội thất cho Anh A">
            </div>

            <div class="page">
                <header class="quote-header">
                    <div class="company-info">
                        <input type="text" id="company-name" class="company-name-input" placeholder="Tên Công Ty Của Bạn">
                        <input type="text" id="company-address" class="company-details-input" placeholder="Địa chỉ">
                        <input type="text" id="company-contact" class="company-details-input" placeholder="Điện thoại | Email">
                        <input type="text" id="company-bank" class="company-details-input" placeholder="Số tài khoản ngân hàng">
                    </div>
                    <div class="quote-title">
                        <h2>BÁO GIÁ</h2>
                        <p>Số: <input type="text" id="quote-number" value="BG-2025-001"></p>
                        <p>Ngày: <span id="quote-date"></span></p>
                    </div>
                </header>

                <section class="client-info">
                     <div class="client-info-grid">
                        <label for="client-name">Kính gửi:</label>
                        <input type="text" id="client-name" placeholder="Tên khách hàng / Tên công ty">
                        <label for="client-phone">Điện thoại:</label>
                        <input type="text" id="client-phone" placeholder="Số điện thoại">
                        <label for="client-address">Địa chỉ:</label>
                        <input type="text" id="client-address" placeholder="Địa chỉ khách hàng">
                    </div>
                </section>

                <section class="quote-details">
                    <table id="quote-table">
                        <thead>
                            <tr>
                                <th class="col-stt">STT</th>
                                <th class="col-content">Nội dung</th>
                                <th class="col-unit">Đơn vị</th>
                                <th class="col-volume">KL (m²)</th>
                                <th class="col-qty">SL</th>
                                <th class="col-price">Đơn giá</th>
                                <th class="col-total">Thành tiền</th>
                                <th class="col-actions actions-col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be added here by JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" class="total-label">Tổng cộng</td>
                                <td id="subtotal" class="total-value">0</td>
                                <td class="actions-col"></td>
                            </tr>
                            <tr>
                                 <td colspan="6" class="total-label">
                                    Thuế VAT (<input type="number" id="vat-rate" value="10" min="0" max="100">%)
                                </td>
                                <td id="tax" class="total-value">0</td>
                                <td class="actions-col"></td>
                            </tr>
                            <tr>
                                <td colspan="6" class="total-label grand-total-label">TỔNG THANH TOÁN</td>
                                <td id="grand-total" class="total-value">0</td>
                                <td class="actions-col"></td>
                            </tr>
                        </tfoot>
                    </table>
                </section>

                <div class="table-actions no-print">
                    <button id="add-row">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Thêm Hạng Mục
                    </button>
                    <button id="add-category">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                        Thêm Nhóm
                    </button>
                    <button id="add-from-saved">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>
                        Thêm từ mục đã lưu
                    </button>
                </div>

                <footer class="quote-footer">
                    <div class="notes">
                        <strong>Ghi chú:</strong>
                        <textarea id="notes-area" rows="3" placeholder="Ví dụ: Báo giá có hiệu lực trong 30 ngày..."></textarea>
                    </div>
                    <div class="signature">
                        <p><strong>Người lập báo giá</strong></p>
                        <p>(Ký và ghi rõ họ tên)</p>
                    </div>
                </footer>
            </div>

            <div class="controls no-print">
                <button id="clear-quote-btn">Làm Trống Báo Giá</button>
                <button id="save-quote-btn">Lưu Báo Giá</button>
                <button onclick="window.print()">Xuất PDF / In</button>
            </div>
        </div>

        <div id="list-view" class="no-print" style="display: none;">
             <div class="list-view-header">
                <h2>Danh Sách Báo Giá</h2>
                <div class="list-view-actions">
                    <input type="search" id="search-quotes-input" placeholder="Tìm kiếm theo tên, khách hàng...">
                    <button id="create-new-quote-from-list" class="btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Tạo Báo Giá Mới
                    </button>
                </div>
            </div>
            <div id="saved-quotes-container">
                <!-- Quote cards will be populated by JS -->
            </div>
        </div>

        <div id="management-view" class="no-print" style="display: none;">
             <div class="list-view-header">
                <h2>Quản lý Hạng mục/Sản phẩm</h2>
            </div>
            <div class="management-content">
                <div class="management-form-container">
                    <h3 id="management-form-title">Thêm Hạng mục mới</h3>
                    <form id="add-item-form">
                        <input type="text" id="item-form-name" placeholder="Tên hạng mục, sản phẩm..." required>
                        <textarea id="item-form-spec" placeholder="Quy cách, mô tả chi tiết..." rows="2"></textarea>
                        <div class="form-row">
                            <input type="text" id="item-form-unit" placeholder="Đơn vị (cái, m², ...)" value="cái" required>
                            <input type="text" id="item-form-price" placeholder="Đơn giá" inputmode="numeric" required>
                        </div>
                         <input type="hidden" id="item-form-id">
                        <button type="submit" id="item-form-submit-btn" class="btn-primary">Lưu Hạng Mục</button>
                        <button type="button" id="item-form-cancel-btn" style="display: none;">Hủy</button>
                    </form>
                </div>
                <div class="management-list-container">
                    <h3>Hạng mục đã lưu</h3>
                    <div id="saved-items-list">
                         <p class="empty-list-message">Chưa có hạng mục nào được lưu.</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div id="autocomplete-box" class="autocomplete-box no-print"></div>

    <div id="confirm-modal" class="modal-overlay no-print" style="display: none;">
        <div class="modal-content" role="alertdialog" aria-labelledby="confirm-title" aria-describedby="confirm-message">
            <div class="modal-header">
                <h2 id="confirm-title">Xác nhận</h2>
            </div>
            <div class="modal-body">
                <p id="confirm-message">Bạn có chắc chắn muốn xóa mục này không?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel-btn">Hủy</button>
                <button id="confirm-ok-btn" class="btn-danger">Xác nhận</button>
            </div>
        </div>
    </div>

    <div id="select-item-modal" class="modal-overlay no-print" style="display: none;">
        <div class="modal-content" role="dialog" aria-labelledby="select-item-title">
            <div class="modal-header">
                <h2 id="select-item-title">Chọn hạng mục để thêm</h2>
                 <button class="close-modal-btn" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="search" id="search-saved-items-input" class="search-modal-input" placeholder="Tìm kiếm hạng mục...">
                <div id="select-item-list">
                    <!-- List of saved items for selection -->
                </div>
            </div>
        </div>
    </div>

    <div id="save-indicator" class="no-print">Đã lưu ✓</div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    
    <script src="script.js" defer></script>
</body>
</html>